---
title: "MVA6.Rmd"
author: "KDR"
date: "11/21/2019"
output: word_document
---


Euro dataset.
```{r}
euro <- read.csv("http://tiny.cc/isqs6350_euroemp", header=TRUE, row.names=1)
head(euro)

# Remove outliers (removing Albania and Giblartar).
euro.c <- euro[-c(19,28), ]

# and focus on numerical variables (removing the first column)
mydata = euro.c[, -1] 
head(mydata)
```
a) Create a hierarchical clustering dendrogram based on complete linkage (default). Don’t forget to extract your distance matrix from the scaled data.
```{r}
#scale the data, then convert to a distance matrix. Use the distance matrix to create clusters. 

mydata.s <- scale(mydata)
d <- dist(mydata.s)
hc <- hclust(d, "complete")
plot(hc, main = "Complete Linkage HC Dendogram")
```
b) Identify the appropriate number of clusters in Hierarchical clustering using a scree plot (hint: plot the reverse of hc$height). Answer: 3 clusters seems to be appropriate due to the elbow drop off. 
```{r}
#names(hc)
#plot((hc$height)) # hard to interpret, so reverse. 
plot(rev(hc$height))
```

c) Based on your decision in part b, determine what countries are in which group?
```{r}

ct <- cutree(hc, 3) 
#ct
crime.clust <- data.frame(ct) # can convert to a data frame. 
#crime.clust 
table(crime.clust) # we see how many countries are in each group. 
```
Now we can see specifially which countries are in each cluster:
Countries in Cluster 1:
```{r}
cluster1 = subset(rownames(euro), ct==1)
cluster1
```
Countries in Cluster 2:
```{r}
cluster2 = subset(rownames(euro), ct==2)
cluster2
```
Countries in Cluster 3:
```{r}
cluster3 = subset(rownames(euro), ct==3)
cluster3
```
d) Identify the appropriate number of clusters in kmeans clustering based on the WGSS scree plot function. 
4 clusters seems appropriate due to the output. 
```{r}
# You have to set this function prior to useing it:
plot.wgss = function(mydata, maxc) {
  wss = numeric(maxc)
  for (i in 1:maxc)
    wss[i] = kmeans(mydata, centers=i, nstart = 10)$tot.withinss
  plot(1:maxc, wss, type="b", xlab="Number of Clusters",
       ylab="within group sum of squares", main="Scree Plot")
}
```
```{r}
plot.wgss(mydata.s, 20)
```

e) Based on your decision in part d, perform k-means clustering and determine what
countries are in which group.
```{r}
# I'm first checking the table to determine how many countries are in each cluster. 
mydata.s <- scale(mydata)
km <- kmeans(mydata.s, centers =4, nstart = 10) # Applying kmeans for k=4 clusters, and setting 10 simulations for accuracy. 
table(km$cluster)
 
```
Countries in Cluster 1:
```{r}
subset(mydata.s, km$cluster ==1)
```
Countries in Cluster 2:
```{r}
subset(mydata.s, km$cluster ==2)
```
Countries in Cluster 3:
```{r}
subset(mydata.s, km$cluster ==3)
```
Countries in Cluster 4:
```{r}
subset(mydata.s, km$cluster ==4)
```
f) Attempt to identify the meanings of the clusters you found in part e by finding and interpreting the cluster centroids.
```{r}
km$centers
```
h) Perform model-based clustering without identifying the number of clusters. Plot the result of classification.  
```{r}
#install.packages("mclust") # this will allow us to use classification.
library(mclust)
mc <- Mclust(mydata)
table(mc$classification) # 2 clusters. 

plot(mc, what = "classification")

```
How many groups are identified in your data?
The output shows 2 groups/clusters. 

Determine what countries are in which group.
```{r}
clust.data = cbind(rownames(mydata), mc$classification, mc$uncertainty)
clust.data[order(mc$uncertainty),]
```

i) Use “plot” on your fitted mclust object, and report the “uncertainty” plot for variables (SER, SPS), which is dimens = c(6,8). Explain the grouping of what country is more uncertain with what probability of uncertainty.
The output show the most uncertain grouping to be Malta, displayed by a large red circle. 

"i) The Malta is the answer."
```{r}
plot(mc, what = "uncertainty", dimens = c(6,8)) # for only two variables; SER and SPS
text(mc$data[,c(6,8)], labels = abbreviate(rownames(mydata)), col = mc$classification)
```

j) Construct the appropriate contingency table between the given grouping in the original cleaned data
(euro.c$Group) and the groups we found in the model-based clustering. Interpret the table, and explain how well do
the model-based clusters correspond? Code for contingency table is like: table(euro.c$Group, mc$classification).
```{r}
table(euro.c$Group, mc$classification)
```





